<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta property="og:type" content="website">
<meta property="og:title" content="ç‰›èµçš„åšå®¢">
<meta property="og:url" content="http://blog.xiaonyun.com/page/4/index.html">
<meta property="og:site_name" content="ç‰›èµçš„åšå®¢">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ç‰›èµ">
<meta property="article:tag" content="ç‰›èµ åšå®¢">
<meta name="twitter:card" content="summary"><title>ç‰›èµçš„åšå®¢</title><link ref="canonical" href="http://blog.xiaonyun.com/page/4/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"å¤åˆ¶","copySuccess":"å¤åˆ¶æˆåŠŸ","copyError":"å¤åˆ¶å¤±è´¥"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">é¦–é¡µ</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">å½’æ¡£</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">åˆ†ç±»</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">æ ‡ç­¾</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">ç‰›èµçš„åšå®¢</div><div class="header-banner-info__subtitle">å­¦æ— æ­¢å¢ƒ</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2018/05/02/js%E7%9A%84%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/">jsçš„æ·±æµ…æ‹·è´</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2018-05-02</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>å‰è¨€ï¼š<code>JavaScript</code>ä¸­å­˜åœ¨ä¸¤å¤§æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>åŸºæœ¬ç±»å‹</li>
<li>å¼•ç”¨ç±»å‹</li>
</ul>
<p>åŸºæœ¬ç±»å‹æ•°æ®ä¿å­˜åœ¨åœ¨æ ˆå†…å­˜ä¸­</p>
<p>å¼•ç”¨ç±»å‹æ•°æ®ä¿å­˜åœ¨å †å†…å­˜ä¸­ï¼Œå¼•ç”¨æ•°æ®ç±»å‹çš„å˜é‡æ˜¯ä¸€ä¸ªæŒ‡å‘å †å†…å­˜ä¸­å®é™…å¯¹è±¡çš„å¼•ç”¨ï¼Œå­˜åœ¨æ ˆä¸­</p>

        <h2 id="æµ…æ‹·è´">
          <a href="#æµ…æ‹·è´" class="heading-link"><i class="fas fa-link"></i></a><a href="#æµ…æ‹·è´" class="headerlink" title="æµ…æ‹·è´"></a>æµ…æ‹·è´</h2>
      <p>æµ…æ‹·è´ï¼ŒæŒ‡çš„æ˜¯åˆ›å»ºæ–°çš„æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®æœ‰ç€åŸå§‹æ•°æ®å±æ€§å€¼çš„ä¸€ä»½ç²¾ç¡®æ‹·è´</p>
<p>å¦‚æœå±æ€§æ˜¯åŸºæœ¬ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ã€‚å¦‚æœå±æ€§æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯å†…å­˜åœ°å€</p>
<p>å³æµ…æ‹·è´æ˜¯æ‹·è´ä¸€å±‚ï¼Œæ·±å±‚æ¬¡çš„å¼•ç”¨ç±»å‹åˆ™å…±äº«å†…å­˜åœ°å€</p>
<p>ä¸‹é¢ç®€å•å®ç°ä¸€ä¸ªæµ…æ‹·è´</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">shallowClone</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newObj = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span>(obj.<span class="title function_">hasOwnProperty</span>(prop))&#123;</span><br><span class="line">            newObj[prop] = obj[prop];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>åœ¨<code>JavaScript</code>ä¸­ï¼Œå­˜åœ¨æµ…æ‹·è´çš„ç°è±¡æœ‰ï¼š</p>
<ul>
<li><code>Object.assign</code></li>
<li><code>Array.prototype.slice()</code>, <code>Array.prototype.concat()</code></li>
<li>ä½¿ç”¨æ‹“å±•è¿ç®—ç¬¦å®ç°çš„å¤åˆ¶</li>
</ul>

        <h3 id="Object-assign">
          <a href="#Object-assign" class="heading-link"><i class="fas fa-link"></i></a><a href="#Object-assign" class="headerlink" title="Object.assign"></a>Object.assign</h3>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">    <span class="attr">nature</span>: [<span class="string">&#x27;smart&#x27;</span>, <span class="string">&#x27;good&#x27;</span>],</span><br><span class="line">    <span class="attr">names</span>: &#123;</span><br><span class="line">        <span class="attr">name1</span>: <span class="string">&#x27;fx&#x27;</span>,</span><br><span class="line">        <span class="attr">name2</span>: <span class="string">&#x27;xka&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">love</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;fx is a great girl&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> newObj = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, fxObj);</span><br></pre></td></tr></table></div></figure>


        <h3 id="slice">
          <a href="#slice" class="heading-link"><i class="fas fa-link"></i></a><a href="#slice" class="headerlink" title="slice()"></a>slice()</h3>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fxArr = [<span class="string">&quot;One&quot;</span>, <span class="string">&quot;Two&quot;</span>, <span class="string">&quot;Three&quot;</span>]</span><br><span class="line"><span class="keyword">const</span> fxArrs = fxArr.<span class="title function_">slice</span>(<span class="number">0</span>)</span><br><span class="line">fxArrs[<span class="number">1</span>] = <span class="string">&quot;love&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fxArr) <span class="comment">// [&quot;One&quot;, &quot;Two&quot;, &quot;Three&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fxArrs) <span class="comment">// [&quot;One&quot;, &quot;love&quot;, &quot;Three&quot;]</span></span><br></pre></td></tr></table></div></figure>


        <h3 id="concat">
          <a href="#concat" class="heading-link"><i class="fas fa-link"></i></a><a href="#concat" class="headerlink" title="concat()"></a>concat()</h3>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fxArr = [<span class="string">&quot;One&quot;</span>, <span class="string">&quot;Two&quot;</span>, <span class="string">&quot;Three&quot;</span>]</span><br><span class="line"><span class="keyword">const</span> fxArrs = fxArr.<span class="title function_">concat</span>()</span><br><span class="line">fxArrs[<span class="number">1</span>] = <span class="string">&quot;love&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fxArr) <span class="comment">// [&quot;One&quot;, &quot;Two&quot;, &quot;Three&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fxArrs) <span class="comment">// [&quot;One&quot;, &quot;love&quot;, &quot;Three&quot;]</span></span><br></pre></td></tr></table></div></figure>


        <h3 id="æ‹“å±•è¿ç®—ç¬¦">
          <a href="#æ‹“å±•è¿ç®—ç¬¦" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ‹“å±•è¿ç®—ç¬¦" class="headerlink" title="æ‹“å±•è¿ç®—ç¬¦"></a>æ‹“å±•è¿ç®—ç¬¦</h3>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fxArr = [<span class="string">&quot;One&quot;</span>, <span class="string">&quot;Two&quot;</span>, <span class="string">&quot;Three&quot;</span>]</span><br><span class="line"><span class="keyword">const</span> fxArrs = [...fxArr]</span><br><span class="line">fxArrs[<span class="number">1</span>] = <span class="string">&quot;love&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fxArr) <span class="comment">// [&quot;One&quot;, &quot;Two&quot;, &quot;Three&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fxArrs) <span class="comment">// [&quot;One&quot;, &quot;love&quot;, &quot;Three&quot;]</span></span><br></pre></td></tr></table></div></figure>


        <h2 id="æ·±æ‹·è´">
          <a href="#æ·±æ‹·è´" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ·±æ‹·è´" class="headerlink" title="æ·±æ‹·è´"></a>æ·±æ‹·è´</h2>
      <p>æ·±æ‹·è´å¼€è¾Ÿä¸€ä¸ªæ–°çš„æ ˆï¼Œä¸¤ä¸ªå¯¹è±¡å±å®Œæˆç›¸åŒï¼Œä½†æ˜¯å¯¹åº”ä¸¤ä¸ªä¸åŒçš„åœ°å€ï¼Œä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œä¸ä¼šæ”¹å˜å¦ä¸€ä¸ªå¯¹è±¡çš„å±æ€§</p>
<p>å¸¸è§çš„æ·±æ‹·è´æ–¹å¼æœ‰ï¼š</p>
<ul>
<li>_.cloneDeep()</li>
<li>jQuery.extend()</li>
<li>JSON.stringify()</li>
<li>æ‰‹å†™å¾ªç¯é€’å½’</li>
</ul>

        <h3 id="cloneDeep">
          <a href="#cloneDeep" class="heading-link"><i class="fas fa-link"></i></a><a href="#cloneDeep" class="headerlink" title="_.cloneDeep()"></a>_.cloneDeep()</h3>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: &#123; <span class="attr">f</span>: &#123; <span class="attr">g</span>: <span class="number">1</span> &#125; &#125;,</span><br><span class="line">    <span class="attr">c</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = _.<span class="title function_">cloneDeep</span>(obj1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">b</span>.<span class="property">f</span> === obj2.<span class="property">b</span>.<span class="property">f</span>);<span class="comment">// false</span></span><br></pre></td></tr></table></div></figure>


        <h3 id="jQuery-extend">
          <a href="#jQuery-extend" class="heading-link"><i class="fas fa-link"></i></a><a href="#jQuery-extend" class="headerlink" title="jQuery.extend()"></a>jQuery.extend()</h3>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $ = <span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: &#123; <span class="attr">f</span>: &#123; <span class="attr">g</span>: <span class="number">1</span> &#125; &#125;,</span><br><span class="line">    <span class="attr">c</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = $.<span class="title function_">extend</span>(<span class="literal">true</span>, &#123;&#125;, obj1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">b</span>.<span class="property">f</span> === obj2.<span class="property">b</span>.<span class="property">f</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></div></figure>


        <h3 id="JSON-stringify">
          <a href="#JSON-stringify" class="heading-link"><i class="fas fa-link"></i></a><a href="#JSON-stringify" class="headerlink" title="JSON.stringify()"></a>JSON.stringify()</h3>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj2=<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj1));</span><br></pre></td></tr></table></div></figure>

<p>ä½†æ˜¯è¿™ç§æ–¹å¼å­˜åœ¨å¼Šç«¯ï¼Œä¼šå¿½ç•¥<code>undefined</code>ã€<code>symbol</code>å’Œ<code>å‡½æ•°</code></p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">    <span class="attr">name1</span>: <span class="literal">undefined</span>,</span><br><span class="line">    <span class="attr">name3</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">    <span class="attr">name4</span>:  <span class="title class_">Symbol</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> obj2 = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2); <span class="comment">// &#123;name: &quot;A&quot;&#125;</span></span><br></pre></td></tr></table></div></figure>


        <h3 id="å¾ªç¯é€’å½’">
          <a href="#å¾ªç¯é€’å½’" class="heading-link"><i class="fas fa-link"></i></a><a href="#å¾ªç¯é€’å½’" class="headerlink" title="å¾ªç¯é€’å½’"></a>å¾ªç¯é€’å½’</h3>
      <figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">obj, hash = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span>) <span class="keyword">return</span> obj; <span class="comment">// å¦‚æœæ˜¯nullæˆ–è€…undefinedæˆ‘å°±ä¸è¿›è¡Œæ‹·è´æ“ä½œ</span></span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title class_">Date</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(obj);</span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title class_">RegExp</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegExp</span>(obj);</span><br><span class="line">  <span class="comment">// å¯èƒ½æ˜¯å¯¹è±¡æˆ–è€…æ™®é€šçš„å€¼  å¦‚æœæ˜¯å‡½æ•°çš„è¯æ˜¯ä¸éœ€è¦æ·±æ‹·è´</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">&quot;object&quot;</span>) <span class="keyword">return</span> obj;</span><br><span class="line">  <span class="comment">// æ˜¯å¯¹è±¡çš„è¯å°±è¦è¿›è¡Œæ·±æ‹·è´</span></span><br><span class="line">  <span class="keyword">if</span> (hash.<span class="title function_">get</span>(obj)) <span class="keyword">return</span> hash.<span class="title function_">get</span>(obj);</span><br><span class="line">  <span class="keyword">let</span> cloneObj = <span class="keyword">new</span> obj.<span class="title function_">constructor</span>(<span class="params"></span>);</span><br><span class="line">  <span class="comment">// æ‰¾åˆ°çš„æ˜¯æ‰€å±ç±»åŸå‹ä¸Šçš„constructor,è€ŒåŸå‹ä¸Šçš„ constructoræŒ‡å‘çš„æ˜¯å½“å‰ç±»æœ¬èº«</span></span><br><span class="line">  hash.<span class="title function_">set</span>(obj, cloneObj);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">      <span class="comment">// å®ç°ä¸€ä¸ªé€’å½’æ‹·è´</span></span><br><span class="line">      cloneObj[key] = <span class="title function_">deepClone</span>(obj[key], hash);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cloneObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="å°ç»“">
          <a href="#å°ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2>
      <p>å‰æä¸ºæ‹·è´ç±»å‹ä¸ºå¼•ç”¨ç±»å‹çš„æƒ…å†µä¸‹ï¼š</p>
<ul>
<li>æµ…æ‹·è´æ˜¯æ‹·è´ä¸€å±‚ï¼Œå±æ€§ä¸ºå¯¹è±¡æ—¶ï¼Œæµ…æ‹·è´æ˜¯å¤åˆ¶ï¼Œä¸¤ä¸ªå¯¹è±¡æŒ‡å‘åŒä¸€ä¸ªåœ°å€</li>
<li>æ·±æ‹·è´æ˜¯é€’å½’æ‹·è´æ·±å±‚æ¬¡ï¼Œå±æ€§ä¸ºå¯¹è±¡æ—¶ï¼Œæ·±æ‹·è´æ˜¯æ–°å¼€æ ˆï¼Œä¸¤ä¸ªå¯¹è±¡æŒ‡å‘ä¸åŒçš„åœ°å€</li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2018/04/29/diff%E7%AE%97%E6%B3%95/">diffç®—æ³•</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2018-04-29</span></span></div></header><div class="post-body"><div class="post-excerpt"><ul>
<li>æŠŠæ ‘å½¢ç»“æ„æŒ‰ç…§å±‚çº§åˆ†è§£ï¼Œåªæ¯”è¾ƒåŒçº§å…ƒç´ ã€‚</li>
<li>ç»™åˆ—è¡¨ç»“æ„çš„æ¯ä¸ªå•å…ƒæ·»åŠ å”¯ä¸€çš„<code>key</code>å±æ€§ï¼Œæ–¹ä¾¿æ¯”è¾ƒã€‚</li>
<li><code>React</code> åªä¼šåŒ¹é…ç›¸åŒ <code>class</code> çš„ <code>component</code>ï¼ˆè¿™é‡Œé¢çš„<code>class</code>æŒ‡çš„æ˜¯ç»„ä»¶çš„åå­—ï¼‰</li>
<li>åˆå¹¶æ“ä½œï¼Œè°ƒç”¨ <code>component</code> çš„ <code>setState</code> æ–¹æ³•çš„æ—¶å€™, <code>React</code> å°†å…¶æ ‡è®°ä¸º - <code>dirty</code>.åˆ°æ¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»“æŸ, <code>React</code> æ£€æŸ¥æ‰€æœ‰æ ‡è®° <code>dirty</code>çš„ <code>component</code>é‡æ–°ç»˜åˆ¶.</li>
<li>é€‰æ‹©æ€§å­æ ‘æ¸²æŸ“ã€‚å¼€å‘äººå‘˜å¯ä»¥é‡å†™<code>shouldComponentUpdate</code>æé«˜<code>diff</code>çš„æ€§èƒ½</li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2018/02/04/%E8%AF%B4%E8%AF%B4%E4%BD%A0%E5%AF%B9%E9%97%AD%E5%8C%85%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9F%E9%97%AD%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/">è¯´è¯´ä½ å¯¹é—­åŒ…çš„ç†è§£ï¼Ÿé—­åŒ…çš„ä½¿ç”¨åœºæ™¯</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2018-02-04</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="æ¦‚å¿µ">
          <a href="#æ¦‚å¿µ" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2>
      <p>é—­åŒ…å®é™…ä¸Šå°±æ˜¯å‡½æ•°ä¸­åµŒå¥—äº†ä¸€ä¸ªå‡½æ•°å¹¶è¿”å›ï¼Œå†…éƒ¨å‡½æ•°è¯»å–äº†å¤–éƒ¨å‡½æ•°çš„å˜é‡ï¼Œé—­åŒ…ä¸­çš„å˜é‡ä¸ä¼šè¢«å›æ”¶æ‰ï¼Œä¿ç•™åœ¨å†…å­˜å½“ä¸­ã€‚</p>
<p><strong>â†’ ç‰¹æ€§ï¼š</strong></p>
<p>   â€‚â€‚â€‚â€‚1. å‡½æ•°åµŒå¥—å‡½æ•°<br>   â€‚â€‚â€‚â€‚2. å†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡<br>   â€‚â€‚â€‚â€‚3. å‚æ•°å’Œå˜é‡ä¸ä¼šè¢«å›æ”¶ã€‚</p>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½æ»¥ç”¨é—­åŒ…ï¼Œå› ä¸ºå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºï¼Œå¯¼è‡´æœåŠ¡å™¨å®•æœºã€‚</p>

        <h2 id="ä½¿ç”¨åœºæ™¯">
          <a href="#ä½¿ç”¨åœºæ™¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2>
      <p>é—­åŒ…çš„å…¸å‹æ¡†æ¶åº”è¯¥å°±æ˜¯jqueryäº†ã€‚</p>
<p>ä¾‹å¦‚é˜²æŠ–ã€èŠ‚æµç­‰éƒ½å¯ä»¥ç”¨åˆ°é—­åŒ…ã€‚</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2018/02/03/vue-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/">vue ç”Ÿå‘½å‘¨æœŸ</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2018-02-03</span></span></div></header><div class="post-body"><div class="post-excerpt"><p><img src="/2018/02/03/vue-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/001.png" alt="img"></p>
<p>*<strong>init*</strong></p>
<ul>
<li><p><code>initLifecycle/Event</code>ï¼Œå¾€vmä¸ŠæŒ‚è½½å„ç§å±æ€§</p>
</li>
<li><p><code>callHook: beforeCreated</code>: å®ä¾‹åˆšåˆ›å»º</p>
</li>
<li><p><code>initInjection/initState</code>: åˆå§‹åŒ–æ³¨å…¥å’Œ <code>data</code> å“åº”æ€§</p>
</li>
<li><p><code>created: åˆ›å»ºå®Œæˆï¼Œå±æ€§å·²ç»ç»‘å®šï¼Œ ä½†è¿˜æœªç”ŸæˆçœŸå®</code>dom`</p>
</li>
<li><p>è¿›è¡Œå…ƒç´ çš„æŒ‚è½½ï¼š <code>$el / vm.$mount()</code></p>
</li>
<li><p>æ˜¯å¦æœ‰</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">template</span><br></pre></td></tr></table></div></figure>

<p>: è§£ææˆ</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render function</span><br></pre></td></tr></table></div></figure>

<ul>
<li><code>*.vue</code>æ–‡ä»¶: <code>vue-loader</code>ä¼šå°†<code>&lt;template&gt;</code>ç¼–è¯‘æˆ<code>render function</code></li>
</ul>
</li>
<li><p><code>beforeMount</code>: æ¨¡æ¿ç¼–è¯‘/æŒ‚è½½ä¹‹å‰</p>
</li>
<li><p>æ‰§è¡Œ<code>render function</code>ï¼Œç”ŸæˆçœŸå®çš„<code>dom</code>ï¼Œå¹¶æ›¿æ¢åˆ°<code>dom tree</code>ä¸­</p>
</li>
<li><p><code>mounted</code>: ç»„ä»¶å·²æŒ‚è½½</p>
</li>
</ul>
<p><strong>update</strong></p>
<ul>
<li><p>æ‰§è¡Œ<code>diff</code>ç®—æ³•ï¼Œæ¯”å¯¹æ”¹å˜æ˜¯å¦éœ€è¦è§¦å‘<code>UI</code>æ›´æ–°</p>
</li>
<li><p><code>flushScheduleQueue</code></p>
</li>
<li><p><code>watcher.before</code>: è§¦å‘<code>beforeUpdate</code>é’©å­ - <code>watcher.run()</code>: æ‰§è¡Œ<code>watcher</code>ä¸­çš„ <code>notify</code>ï¼Œé€šçŸ¥æ‰€æœ‰ä¾èµ–é¡¹æ›´æ–°UI</p>
</li>
<li><p>è§¦å‘<code>updated</code>é’©å­: ç»„ä»¶å·²æ›´æ–°</p>
</li>
<li><p><code>actived / deactivated(keep-alive)</code>: ä¸é”€æ¯ï¼Œç¼“å­˜ï¼Œç»„ä»¶æ¿€æ´»ä¸å¤±æ´»</p>
</li>
<li><pre><code>destroy
</code></pre>
<ul>
<li><code>beforeDestroy</code>: é”€æ¯å¼€å§‹</li>
<li>é”€æ¯è‡ªèº«ä¸”é€’å½’é”€æ¯å­ç»„ä»¶ä»¥åŠäº‹ä»¶ç›‘å¬<ul>
<li><code>remove()</code>: åˆ é™¤èŠ‚ç‚¹</li>
<li><code>watcher.teardown()</code>: æ¸…ç©ºä¾èµ–</li>
<li><code>vm.$off()</code>: è§£ç»‘ç›‘å¬</li>
</ul>
</li>
<li><code>destroyed</code>: å®Œæˆåè§¦å‘é’©å­</li>
</ul>
</li>
</ul>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">Vue2</th>
<th align="left">Vue3</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>beforeCreate</code></td>
<td align="left">âŒ<code>setup</code>(æ›¿ä»£)</td>
</tr>
<tr>
<td align="left"><code>created</code></td>
<td align="left">âŒ<code>setup</code>(æ›¿ä»£)</td>
</tr>
<tr>
<td align="left"><code>beforeMount</code></td>
<td align="left"><code>onBeforeMount</code></td>
</tr>
<tr>
<td align="left"><code>mounted</code></td>
<td align="left"><code>onMounted</code></td>
</tr>
<tr>
<td align="left"><code>beforeUpdate</code></td>
<td align="left"><code>onBeforeUpdate</code></td>
</tr>
<tr>
<td align="left"><code>updated</code></td>
<td align="left"><code>nUpdated</code></td>
</tr>
<tr>
<td align="left"><code>beforeDestroy</code></td>
<td align="left"><code>onBeforeUnmount</code></td>
</tr>
<tr>
<td align="left"><code>destroyed</code></td>
<td align="left"><code>onUnmounted</code></td>
</tr>
<tr>
<td align="left"><code>errorCaptured</code></td>
<td align="left"><code>onErrorCaptured</code></td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">ğŸ‰<code>onRenderTracked</code></td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">ğŸ‰<code>onRenderTriggered</code></td>
</tr>
</tbody></table></div>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2017/12/05/New%E7%9A%84%E5%8E%9F%E7%90%86/">Newçš„åŸç†</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2017-12-05</span></span></div></header><div class="post-body"><div class="post-excerpt"><blockquote>
<p>new å…³é”®è¯çš„<code>ä¸»è¦ä½œç”¨å°±æ˜¯æ‰§è¡Œä¸€ä¸ªæ„é€ å‡½æ•°ã€è¿”å›ä¸€ä¸ªå®ä¾‹å¯¹è±¡</code>ï¼Œåœ¨ new çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®æ„é€ å‡½æ•°çš„æƒ…å†µï¼Œæ¥ç¡®å®šæ˜¯å¦å¯ä»¥æ¥å—å‚æ•°çš„ä¼ é€’ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€æ®µä»£ç æ¥çœ‹ä¸€ä¸ªç®€å•çš„ new çš„ä¾‹å­</p>
</blockquote>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&#x27;Jack&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(); </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>)  <span class="comment">// Jack</span></span><br></pre></td></tr></table></div></figure>

<p>è¿™æ®µä»£ç æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œp æ˜¯ä¸€ä¸ªé€šè¿‡ person è¿™ä¸ªæ„é€ å‡½æ•°ç”Ÿæˆçš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªåº”è¯¥å¾ˆå®¹æ˜“ç†è§£ã€‚</p>
<blockquote>
<p><code>new</code> æ“ä½œç¬¦å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ„å»ºå‡ºä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”ç»‘å®šä¸Š thisï¼Œå†…éƒ¨æ‰§è¡Œæ­¥éª¤å¯å¤§æ¦‚åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p>
</blockquote>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</li>
<li>å¯¹è±¡è¿æ¥åˆ°æ„é€ å‡½æ•°åŸå‹ä¸Šï¼Œå¹¶ç»‘å®š <code>this</code>ï¼ˆthis æŒ‡å‘æ–°å¯¹è±¡ï¼‰</li>
<li>æ‰§è¡Œæ„é€ å‡½æ•°ä»£ç ï¼ˆä¸ºè¿™ä¸ªæ–°å¯¹è±¡æ·»åŠ å±æ€§ï¼‰</li>
<li>è¿”å›æ–°å¯¹è±¡</li>
</ol>
<p>æ€»ç»“ï¼š<code>new å…³é”®è¯æ‰§è¡Œä¹‹åæ€»æ˜¯ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯å®ä¾‹å¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯ return è¯­å¥æŒ‡å®šçš„å¯¹è±¡</code></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2017/11/28/setState%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E5%BC%82%E6%AD%A5%E7%9A%84/">setStateä¸ºä»€ä¹ˆæ˜¯å¼‚æ­¥çš„</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2017-11-28</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="å¼‚æ­¥ç°è±¡">
          <a href="#å¼‚æ­¥ç°è±¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#å¼‚æ­¥ç°è±¡" class="headerlink" title="å¼‚æ­¥ç°è±¡"></a>å¼‚æ­¥ç°è±¡</h2>
      <p>çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">a</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start&#x27;</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">a</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">2</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set state&#x27;</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">a</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;end&#x27;</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">a</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>è¾“å‡ºç»“æœä¸º<code>start 1 -&gt; end 1 -&gt; set state 2</code>ã€‚</p>
<p>è¿™ä¸ªç»“æœå¾ˆæ˜æ˜¾è¯´æ˜äº†<code>setState</code>æ˜¯å¼‚æ­¥çš„ã€‚</p>
<p>æ—¢ç„¶å·²ç»æ˜ç¡®<code>setState</code>æ˜¯å¼‚æ­¥çš„äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¢ç´¢ä¸€ä¸‹ï¼Œ<code>setState</code>æ˜¯å®ä»»åŠ¡ï¼Œè¿˜æ˜¯å¾®ä»»åŠ¡å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„ä»£ç </p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">a</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start&#x27;</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">a</span>)</span><br><span class="line">    <span class="comment">// æ·»åŠ äº†promiseå’ŒsetTimeoutçš„ä»£ç </span></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise&#x27;</span>))</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set timeout&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">2</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set state&#x27;</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">a</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;end&#x27;</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">a</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>è¾“å‡ºç»“æœä¸º<code>start 1 -&gt; end 1 -&gt; set state 2 -&gt; promise -&gt; set timeout</code>ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>setState</code>å›è°ƒçš„è¾“å‡ºåœ¨<code>promise</code>ä¹‹å‰ã€‚çº³å°¼ï¼Ÿéš¾é“è¯´<code>setState</code>å†…éƒ¨å®ç°äº†æ¯”<code>promise</code>ä¼˜å…ˆçº§è¿˜è¦é«˜çš„å¾®ä»»åŠ¡å—ï¼Ÿ<code>react</code>è¿˜å·å·æ‘¸æ‘¸åœ°å®ç°äº†ä¸€ä¸ªæ–°çš„æµè§ˆå™¨APIï¼Ÿ</p>

        <h2 id="é€è¿‡ç°è±¡çœ‹æœ¬è´¨">
          <a href="#é€è¿‡ç°è±¡çœ‹æœ¬è´¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#é€è¿‡ç°è±¡çœ‹æœ¬è´¨" class="headerlink" title="é€è¿‡ç°è±¡çœ‹æœ¬è´¨"></a>é€è¿‡ç°è±¡çœ‹æœ¬è´¨</h2>
      <p>å¾ˆæ˜æ˜¾ï¼Œå‰é¢æå‡ºçš„é—®é¢˜æ˜¯ä¸å¯èƒ½çš„ã€‚é‚£ä¹ˆï¼Œ<code>setState</code>çš„è¾“å‡ºç»“æœåˆè¯¥ä½œä½•è§£é‡Šå‘¢ï¼Ÿä¸å¦‚æ¥çœ‹ä¸€ä¸‹<code>react</code>æ˜¯å¦‚ä½•å®ç°<code>setState</code>çš„å§ã€‚</p>
<p><code>setState</code>ä¼šè°ƒç”¨<code>classComponentUpdater</code>çš„<code>enqueueSetState</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨<code>enqueueUpdate</code>æ–¹æ³•ï¼Œå…¥é˜Ÿä¸€ä¸ª<code>update</code>å¯¹è±¡ï¼Œä¹‹åè°ƒç”¨<code>scheduleUpdateOnFiber</code>æ¥è°ƒåº¦æ›´æ–°ã€‚</p>
<blockquote>
<p>ä¸çŸ¥é“<code>classComponentUpdater</code>æ˜¯ä»€ä¹ˆçš„åŒå­¦å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡è®²è§£classç»„ä»¶æ›´æ–°åŸç†çš„<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://juejin.cn/post/6987765899298078727">æ–‡ç« </a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
<p><code>scheduleUpdateOnFiber</code>æ–¹æ³•æºç å¦‚ä¸‹(åˆ é™¤äº†ä¸é‡è¦çš„ä»£ç )</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">scheduleUpdateOnFiber</span>(<span class="params">fiber, lane, eventTime</span>) &#123;</span><br><span class="line">  <span class="comment">// ã€‚ã€‚ã€‚</span></span><br><span class="line">  <span class="keyword">if</span> (lane === <span class="title class_">SyncLane</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">    (executionContext &amp; <span class="title class_">LegacyUnbatchedContext</span>) !== <span class="title class_">NoContext</span> &amp;&amp;</span><br><span class="line">    (executionContext &amp; (<span class="title class_">RenderContext</span> | <span class="title class_">CommitContext</span>)) === <span class="title class_">NoContext</span>) &#123;</span><br><span class="line">      <span class="title function_">schedulePendingInteractions</span>(root, lane);</span><br><span class="line"></span><br><span class="line">      <span class="title function_">performSyncWorkOnRoot</span>(root);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">ensureRootIsScheduled</span>(root, eventTime);</span><br><span class="line">      <span class="title function_">schedulePendingInteractions</span>(root, lane);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (executionContext === <span class="title class_">NoContext</span>) &#123;</span><br><span class="line">        <span class="title function_">resetRenderTimer</span>();</span><br><span class="line">        <span class="title function_">flushSyncCallbackQueue</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ã€‚ã€‚ã€‚</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ã€‚ã€‚ã€‚</span></span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>ç”±äºåœ¨<code>react17</code>ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨<code>concurrent mode</code>ï¼Œæ‰€ä»¥<code>lane === SyncLane</code>æˆç«‹ï¼Œä¹‹åçœ‹è¿™ä¸ªåˆ¤æ–­ï¼š</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(executionContext &amp; <span class="title class_">LegacyUnbatchedContext</span>) !== <span class="title class_">NoContext</span> </span><br><span class="line">&amp;&amp;(executionContext &amp; (<span class="title class_">RenderContext</span> | <span class="title class_">CommitContext</span>)) === <span class="title class_">NoContext</span></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>åœ¨æ‰§è¡Œ<code>ReactDOM.render</code>æ–¹æ³•æ—¶ï¼Œä¼šå°†<code>executionContext</code>ç½®ä¸º<code>LegacyUnbatchedContext</code>ï¼Œè€Œè¿›å…¥<code>render</code>é˜¶æ®µæˆ–è€…<code>commit</code>é˜¶æ®µæ—¶ï¼Œ<code>executionContext</code>ä¼šè¢«åˆ†åˆ«ç½®ä¸º<code>RenderContext</code>å’Œ<code>CommitContext</code>ã€‚æ‰€ä»¥ï¼Œåªæœ‰åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œæ‰ä¼šè¿›å…¥è¿™ä¸ªé€»è¾‘ï¼Œæ­¤åçš„æ¯æ¬¡æ›´æ–°ï¼Œéƒ½ä¼šè¿›å…¥<code>else</code>çš„é€»è¾‘ï¼Œå› æ­¤ä¼šæ‰§è¡Œ<code>ensureRootIsScheduled</code>æ–¹æ³•ã€‚</p>
<p><code>ensureRootIsScheduled</code>ä»£ç å¦‚ä¸‹</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ensureRootIsScheduled</span>(<span class="params">root, currentTime</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">if</span> (newCallbackPriority === <span class="title class_">SyncLanePriority</span>) &#123;</span><br><span class="line">    newCallbackNode = <span class="title function_">scheduleSyncCallback</span>(performSyncWorkOnRoot.<span class="title function_">bind</span>(<span class="literal">null</span>, root));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p><code>ensureRootIsScheduled</code>ä»£ç å¦‚ä¸‹</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">scheduleSyncCallback</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">  <span class="comment">// Push this callback into an internal queue. We&#x27;ll flush these either in</span></span><br><span class="line">  <span class="comment">// the next tick, or earlier if something calls `flushSyncCallbackQueue`.</span></span><br><span class="line">  <span class="keyword">if</span> (syncQueue === <span class="literal">null</span>) &#123;</span><br><span class="line">    syncQueue = [callback]; <span class="comment">// Flush the queue in the next tick, at the earliest.</span></span><br><span class="line">    immediateQueueCallbackNode = <span class="title class_">Scheduler</span>_scheduleCallback(<span class="title class_">Scheduler</span>_ImmediatePriority, flushSyncCallbackQueueImpl);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    syncQueue.<span class="title function_">push</span>(callback);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> fakeCallbackNode;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œ<code>ensureRootIsScheduled</code>å°±æ˜¯åˆ©ç”¨<code>scheduler</code>æ¨¡å—æä¾›çš„<code>scheduleCallback</code>æ–¹æ³•æ¥è°ƒåº¦<code>performSyncWorkOnRoot</code>æ–¹æ³•çš„æ‰§è¡Œã€‚äº†è§£<code>scheduler</code>çš„åŒå­¦å¯èƒ½ä¼šè¯´äº†ï¼Œ<code>scheduleCallback</code>ä½¿ç”¨äº†<code>MessageChannel</code>æ¥è°ƒåº¦ä»»åŠ¡çš„æ‰§è¡Œï¼Œé‚£åº”è¯¥æ˜¯å®ä»»åŠ¡å•Šã€‚è¿™ä¸€ç‚¹ç¡®å®æ²¡é”™ï¼Œä½†æ˜¯åœ¨<code>react17</code>ä¸­ï¼Œå¹¶ä¸ä¼šé‡‡ç”¨è¿™ç§æ–¹æ³•æ¥è°ƒåº¦ä»»åŠ¡ï¼Œè€Œæ˜¯ä»ç„¶é‡‡ç”¨äº†åŒæ­¥ä»»åŠ¡çš„æ–¹å¼ã€‚</p>
<p>ç°åœ¨å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨<code>setState</code>çš„åœ°æ–¹ä¸€èˆ¬æœ‰ä¸¤ç§ï¼šåœ¨<code>componentDidMount</code>ä¸­å’Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸­ã€‚</p>

        <h3 id="åœ¨componentDidMountä¸­è°ƒç”¨setStateçš„æƒ…å†µ">
          <a href="#åœ¨componentDidMountä¸­è°ƒç”¨setStateçš„æƒ…å†µ" class="heading-link"><i class="fas fa-link"></i></a><a href="#åœ¨componentDidMountä¸­è°ƒç”¨setStateçš„æƒ…å†µ" class="headerlink" title="åœ¨componentDidMountä¸­è°ƒç”¨setStateçš„æƒ…å†µ"></a>åœ¨<code>componentDidMount</code>ä¸­è°ƒç”¨<code>setState</code>çš„æƒ…å†µ</h3>
      <p>å…ˆçœ‹<code>ReactDOM.render</code>ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨<code>legacyRenderSubtreeIntoContainer</code>ï¼Œè€Œè¿™ä¸ªæ–¹æ³•ä¸­æœ‰è¿™æ ·ä¸€æ®µä»£ç </p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">unbatchedUpdates</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">updateContainer</span>(children, fiberRoot, parentComponent, callback);</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>çœ‹ä¸€ä¸‹<code>unbatchedUpdates</code>çš„å®ç°</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unbatchedUpdates</span>(<span class="params">fn, a</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> prevExecutionContext = executionContext;</span><br><span class="line">  executionContext &amp;= ~<span class="title class_">BatchedContext</span>;</span><br><span class="line">  executionContext |= <span class="title class_">LegacyUnbatchedContext</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// fnå°±æ˜¯updateContainer</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fn</span>(a);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    executionContext = prevExecutionContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (executionContext === <span class="title class_">NoContext</span>) &#123;</span><br><span class="line">      <span class="comment">// Flush the immediate callbacks that were scheduled during this batch</span></span><br><span class="line">      <span class="title function_">resetRenderTimer</span>();</span><br><span class="line">      <span class="title function_">flushSyncCallbackQueue</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>æˆ‘ä»¬çš„<code>componentDidMount</code>ç”Ÿå‘½å‘¨æœŸé’©å­å°±æ˜¯åœ¨fnå°±æ˜¯<code>updateContainer</code>ä¸­è°ƒç”¨çš„ï¼Œè€Œ<code>setState</code>æ˜¯åœ¨<code>componentDidMount</code>ä¸­è°ƒç”¨çš„ã€‚ä¹Ÿ<code>updateContainer</code>æ‰§è¡Œå®Œåï¼Œä¼šè¿›å…¥<code>finally</code>çš„é€»è¾‘ï¼Œæ­¤æ—¶<code>executionContext === NoContext</code>æˆç«‹ï¼Œæ‰§è¡Œ<code>flushSyncCallbackQueue</code>æ–¹æ³•ã€‚è¿™é‡Œæ³¨æ„<code>scheduleSyncCallback</code>ä¸­çš„è¿™æ®µæ³¨é‡Š</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Push this callback into an internal queue. We&#x27;ll flush these either in</span></span><br><span class="line"><span class="comment">// the next tick, or earlier if something calls `flushSyncCallbackQueue`.</span></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼Œå°†<code>callback</code>(è¿™é‡Œæ˜¯<code>performSyncWorkOnRoot</code>)æ”¾å…¥ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ—(è¿™é‡Œæ˜¯å…¨å±€å˜é‡<code>syncQueue</code>)ï¼Œå°†ä¼šåœ¨<code>next tick</code>ä¸­è°ƒåº¦è¯¥ä»»åŠ¡ï¼Œæˆ–è€…åœ¨è°ƒç”¨<code>flushSyncCallbackQueue</code>æ—¶æ›´æ—©åœ°è°ƒåº¦ã€‚æ²¡é”™ï¼Œå°±æ˜¯åœ¨<code>unbatchedUpdates</code>ä¸­è°ƒç”¨çš„<code>flushSyncCallbackQueue</code>ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ˜¯åœ¨<code>react</code>çš„åŒæ­¥ä»£ç ä¸­ï¼Œè¿˜æ²¡è¿›å…¥ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯ï¼Œå› æ­¤çš„ç¡®æ˜¯<code>earlier</code></p>
</blockquote>
<p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½å‘ç°äº†ï¼Œåœ¨<code>unbatchedUpdates</code>ä¸­è°ƒç”¨äº†<code>flushSyncCallbackQueue</code>æ¥æ‰§è¡Œ<code>performSyncWorkOnRoot</code>ï¼Œ<code>scheduleSyncCallback</code>ä¸­è¿˜è°ƒåº¦äº†åŒä¸€ä¸ªå‡½æ•°ï¼Œè¿™æ ·ä¸ä¼šè°ƒç”¨ä¸¤æ¬¡å—ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œ<code>flushSyncCallbackQueue</code>å†…éƒ¨åšäº†å¤„ç†</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flushSyncCallbackQueue</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// åœ¨scheduleSyncCallbackä¸­ä¼šä¸ºimmediateQueueCallbackNodeèµ‹å€¼</span></span><br><span class="line">  <span class="keyword">if</span> (immediateQueueCallbackNode !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœimmediateQueueCallbackNodeå­˜åœ¨ï¼Œåˆ™å–æ¶ˆè¿™ä¸ªä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">var</span> node = immediateQueueCallbackNode;</span><br><span class="line">    immediateQueueCallbackNode = <span class="literal">null</span>;</span><br><span class="line">    <span class="title class_">Scheduler</span>_cancelCallback(node);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</span></span><br><span class="line">  <span class="title function_">flushSyncCallbackQueueImpl</span>();</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“äº†ï¼Œ<code>setState</code>å†…éƒ¨ä¼šå°†æ›´æ–°çš„å…¥å£å‡½æ•°<code>performSyncWorkOnRoot</code>æ”¾å…¥ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç­‰åˆ°<code>componentDidMount</code>ä¸­çš„ä»£ç æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå†æ‰§è¡Œ<code>performSyncWorkOnRoot</code>ï¼Œè€Œ<code>setState</code>çš„ç¬¬äºŒä¸ªå‚æ•°çš„å›è°ƒå‡½æ•°ï¼Œå°±æ˜¯åœ¨è¿™ä¸ª<code>performSyncWorkOnRoot</code>ä¸­æ‰§è¡Œçš„ï¼Œå› æ­¤æ‰§è¡Œé¡ºåºä¸ºï¼š<code>componentDidMountä¸­çš„ä»£ç  -&gt; setStateçš„å›è°ƒå‡½æ•°</code>ï¼Œæ‰€ä»¥<code>setState</code>çœ‹èµ·æ¥æ˜¯å¼‚æ­¥çš„ã€‚</p>

        <h3 id="åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è°ƒç”¨setStateçš„æƒ…å†µ">
          <a href="#åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è°ƒç”¨setStateçš„æƒ…å†µ" class="heading-link"><i class="fas fa-link"></i></a><a href="#åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è°ƒç”¨setStateçš„æƒ…å†µ" class="headerlink" title="åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è°ƒç”¨setStateçš„æƒ…å†µ"></a>åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è°ƒç”¨<code>setState</code>çš„æƒ…å†µ</h3>
      <p>ä»ä¸Šä¸€èŠ‚çš„å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œè®©<code>setState</code>â€œå¼‚æ­¥â€æ‰§è¡Œçš„ä¸»è¦åŸå› åœ¨äº<code>unbatchedUpdates</code>æ–¹æ³•ï¼Œè€Œ<code>react</code>åœ¨å¤„ç†äº‹ä»¶å¤„ç†å‡½æ•°æ—¶ï¼Œä¹Ÿä½¿ç”¨äº†ç›¸åŒçš„æ–¹æ³•ï¼Œæ¯”å¦‚è§¦å‘ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œä¼šè§¦å‘<code>dispatchEvent</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨<code>batchedEventUpdates$1</code>ï¼Œ</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">batchedEventUpdates$1</span>(<span class="params">fn, a</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> prevExecutionContext = executionContext;</span><br><span class="line">  executionContext |= <span class="title class_">EventContext</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// fnå°±æ˜¯äº‹ä»¶å¤„ç†ç›¸å…³å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fn</span>(a);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    executionContext = prevExecutionContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (executionContext === <span class="title class_">NoContext</span>) &#123;</span><br><span class="line">      <span class="comment">// Flush the immediate callbacks that were scheduled during this batch</span></span><br><span class="line">      <span class="title function_">resetRenderTimer</span>();</span><br><span class="line">      <span class="title function_">flushSyncCallbackQueue</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œçš„ä»£ç å’Œ<code>unbatchedUpdates</code>åŸºæœ¬ç›¸åŒã€‚</p>

        <h3 id="å°ç»“">
          <a href="#å°ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3>
      <p>å¯ä»¥çœ‹å‡ºï¼Œ<code>setState</code>å†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œå½“<code>setState</code>æ‰§è¡Œæ—¶ï¼Œä¼šå°†è§¦å‘æ›´æ–°çš„å‡½æ•°<code>performSyncWorkOnRoot</code>æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¹‹åç»§ç»­æ‰§è¡Œå‰©ä½™ä»£ç ï¼Œè€Œ<code>setState</code>çš„å›è°ƒå‡½æ•°ä¼šåœ¨<code>performSyncWorkOnRoot</code>ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥<code>setState</code>çœ‹èµ·æ¥æ˜¯å¼‚æ­¥çš„ï¼Œä½†å®é™…ä¸Šï¼Œ<code>setState</code>è¿˜æ˜¯åŒæ­¥ä»»åŠ¡ï¼Œåªä¸è¿‡å†…éƒ¨çš„æ‰§è¡Œé¡ºåºä¸æ˜¯åŒæ­¥çš„ã€‚</p>
<blockquote>
<p>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰è¿™æ ·çš„ç–‘æƒ‘ï¼šæ—¢ç„¶å·²ç»ç”¨<code>scheduler</code>è°ƒåº¦<code>performSyncWorkOnRoot</code>äº†ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦åœ¨<code>batchedEventUpdates$1</code>ä¸­è°ƒç”¨<code>flushSyncCallbackQueue</code>ï¼Œæ¥å–æ¶ˆè°ƒåº¦çš„ä»»åŠ¡ï¼Œç„¶åâ€æ‰‹åŠ¨â€œæ‰§è¡Œ<code>performSyncWorkOnRoot</code>å‘¢ã€‚æˆ‘æƒ³è¿™å¯èƒ½æ˜¯ä¸ºæœªæ¥çš„<code>concurrent mode</code>åšå‡†å¤‡å§ã€‚</p>
</blockquote>

        <h2 id="å¤šä¸ªsetStateå‘¢">
          <a href="#å¤šä¸ªsetStateå‘¢" class="heading-link"><i class="fas fa-link"></i></a><a href="#å¤šä¸ªsetStateå‘¢" class="headerlink" title="å¤šä¸ªsetStateå‘¢"></a>å¤šä¸ªsetStateå‘¢</h2>
      <p>ç°åœ¨åˆæœ‰äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨äº†å¤šä¸ª<code>setState</code>å‘¢ï¼Œä¼šè§¦å‘å¤šæ¬¡æ›´æ–°å—ï¼Ÿç”¨è¿‡<code>react</code>çš„åŒå­¦åº”è¯¥éƒ½çŸ¥é“å¹¶ä¸ä¼šè§¦å‘å¤šæ¬¡æ›´æ–°ã€‚é‚£è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œæ¥çœ‹ä¸€ä¸‹<code>ensureRootIsScheduled</code>æ–¹æ³•ï¼Œåœ¨è°ƒç”¨<code>scheduleSyncCallback</code>ä¹‹å‰ï¼Œæœ‰è¿™æ ·ä¸€æ®µä»£ç </p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (existingCallbackNode !== <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> existingCallbackPriority = root.<span class="property">callbackPriority</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (existingCallbackPriority === newCallbackPriority) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">cancelCallback</span>(existingCallbackNode);</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p><code>existingCallbackNode</code>å°±æ˜¯è¢«è°ƒåº¦çš„ä»»åŠ¡ï¼Œå½“å·²ç»å­˜åœ¨ä¸€ä¸ªè¢«è°ƒåº¦çš„ä»»åŠ¡æ—¶ï¼Œå¦‚æœæ–°ä»»åŠ¡å’Œè€ä»»åŠ¡çš„ä¼˜å…ˆçº§ç›¸åŒï¼Œç›´æ¥è¿”å›ï¼Œå°±ä¸ä¼šå†è°ƒåº¦ä¸€ä¸ªæ–°ä»»åŠ¡äº†ã€‚</p>

        <h2 id="ç”¨å…¶ä»–æ–¹å¼è°ƒç”¨setStateå‘¢">
          <a href="#ç”¨å…¶ä»–æ–¹å¼è°ƒç”¨setStateå‘¢" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç”¨å…¶ä»–æ–¹å¼è°ƒç”¨setStateå‘¢" class="headerlink" title="ç”¨å…¶ä»–æ–¹å¼è°ƒç”¨setStateå‘¢"></a>ç”¨å…¶ä»–æ–¹å¼è°ƒç”¨setStateå‘¢</h2>
      <p>å‰é¢è¯´äº†åœ¨<code>componentDidMount</code>å’Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸­è°ƒç”¨<code>setState</code>ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯ä¸‹é¢çš„è°ƒç”¨æ–¹å¼å‘¢</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">delay</span>(<span class="number">1000</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">1</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set state cb&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set state1&#x27;</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">a</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">2</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set state cb&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set state2&#x27;</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">a</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>ç”¨<code>delay</code>å‡½æ•°æ¨¡æ‹Ÿæ•°æ®è¯·æ±‚ï¼Œä¹‹åè°ƒç”¨<code>setState</code>ï¼Œè¾“å‡ºç»“æœä¸ºï¼š<code>set state cb -&gt; set state1 1 -&gt; set state cb -&gt; set state2 2</code>ã€‚å¯ä»¥çœ‹å‡ºï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ<code>setState</code>åˆå˜æˆäº†â€œåŒæ­¥â€æ‰§è¡Œäº†ï¼Œè¿™åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿçœ‹ä¸€ä¸‹<code>scheduleUpdateOnFiber</code></p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">scheduleUpdateOnFiber</span>(<span class="params">fiber, lane, eventTime</span>) &#123;</span><br><span class="line">  <span class="comment">// ã€‚ã€‚ã€‚</span></span><br><span class="line">  <span class="title function_">ensureRootIsScheduled</span>(root, eventTime);</span><br><span class="line">  <span class="title function_">schedulePendingInteractions</span>(root, lane);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (executionContext === <span class="title class_">NoContext</span>) &#123;</span><br><span class="line">    <span class="title function_">resetRenderTimer</span>();</span><br><span class="line">    <span class="title function_">flushSyncCallbackQueue</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>å¦‚æœé€šè¿‡<code>promise</code>çš„<code>then</code>å›è°ƒè°ƒç”¨<code>setState</code>ï¼Œç›¸å½“äºå›è°ƒå‡½æ•°è‡ªæ‰§è¡Œï¼Œ<code>executionContext</code>æ²¡æœ‰è¢«èµ‹äºˆä»»ä½•å€¼ï¼Œæ‰€ä»¥<code>executionContext</code>æ˜¯<code>NoContext</code>ï¼Œæ‰€ä»¥æ‰§è¡Œäº†<code>flushSyncCallbackQueue</code>ï¼Œè¿™æ ·ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡<code>setState</code>ï¼Œå°±ä¼šç«‹å³æ‰§è¡Œå¼€å§‹ä¸€æ¬¡æ›´æ–°ï¼Œå› æ­¤ä¸Šæ–‡ä¾‹å­ä¸­çš„è¾“å‡ºæ˜¯åŒæ­¥çš„ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªapiï¼š<code>unstable_batchedUpdates</code></p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">batchedUpdates$1</span>(<span class="params">fn, a</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> prevExecutionContext = executionContext;</span><br><span class="line">  executionContext |= <span class="title class_">BatchedContext</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fn</span>(a);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    executionContext = prevExecutionContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (executionContext === <span class="title class_">NoContext</span>) &#123;</span><br><span class="line">      <span class="comment">// Flush the immediate callbacks that were scheduled during this batch</span></span><br><span class="line">      <span class="title function_">resetRenderTimer</span>();</span><br><span class="line">      <span class="title function_">flushSyncCallbackQueue</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></div></figure>

<p>è¿™æ ·ï¼Œ<code>executionContext</code>å°±ä¸å†æ˜¯<code>NoContext</code>ï¼Œ<code>scheduleUpdateOnFiber</code>ä¸­ä¸ä¼šæå‰å¼€å§‹æ›´æ–°ã€‚</p>

        <h2 id="æ€»ç»“">
          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2>
      <p>ä»è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>setState</code>ä¹‹æ‰€ä»¥çœ‹èµ·æ¥æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸æ˜¯ä½¿ç”¨äº†å®ä»»åŠ¡æˆ–è€…å¾®ä»»åŠ¡ï¼Œè€Œæ˜¯ç”¨åŒæ­¥ä»£ç ï¼Œå®ç°äº†å¼‚æ­¥æ‰§è¡Œçš„æ•ˆæœã€‚è€Œå…·ä½“å®ç°æ–¹å¼ï¼Œå°±æ˜¯é€šè¿‡å†…éƒ¨çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œå»¶è¿Ÿæ‰§è¡Œæ›´æ–°ã€‚</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2017/11/18/Redux%E4%B8%89%E5%A4%A7%E5%8E%9F%E5%88%99/">Reduxä¸‰å¤§åŸåˆ™</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2017-11-18</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h3 id="å”¯ä¸€æ•°æ®æº">
          <a href="#å”¯ä¸€æ•°æ®æº" class="heading-link"><i class="fas fa-link"></i></a><a href="#å”¯ä¸€æ•°æ®æº" class="headerlink" title="å”¯ä¸€æ•°æ®æº"></a>å”¯ä¸€æ•°æ®æº</h3>
      <p>æ•´ä¸ªåº”ç”¨çš„stateéƒ½è¢«å­˜å‚¨åˆ°ä¸€ä¸ªçŠ¶æ€æ ‘é‡Œé¢ï¼Œå¹¶ä¸”è¿™ä¸ªçŠ¶æ€æ ‘ï¼Œåªå­˜åœ¨äºå”¯ä¸€çš„storeä¸­</p>

        <h3 id="ä¿æŒåªè¯»çŠ¶æ€">
          <a href="#ä¿æŒåªè¯»çŠ¶æ€" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¿æŒåªè¯»çŠ¶æ€" class="headerlink" title="ä¿æŒåªè¯»çŠ¶æ€"></a>ä¿æŒåªè¯»çŠ¶æ€</h3>
      <p>stateæ˜¯åªè¯»çš„ï¼Œå”¯ä¸€æ”¹å˜stateçš„æ–¹æ³•å°±æ˜¯è§¦å‘actionï¼Œactionæ˜¯ä¸€ä¸ªç”¨äºæè¿°ä»¥å‘ç”Ÿæ—¶é—´çš„æ™®é€šå¯¹è±¡<br>æ•°æ®æ”¹å˜åªèƒ½é€šè¿‡çº¯å‡½æ•°æ¥æ‰§è¡Œ</p>

        <h3 id="ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹">
          <a href="#ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹" class="headerlink" title="ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹"></a>ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹</h3>
      <p>ä¸ºäº†æè¿°actionå¦‚ä½•æ”¹å˜stateçš„ï¼Œä½ éœ€è¦ç¼–å†™reducers</p>
<p>Reduxæºç </p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">let createStore = (reducer) =&gt; &#123;</span><br><span class="line">    let state;</span><br><span class="line">    //è·å–çŠ¶æ€å¯¹è±¡</span><br><span class="line">    //å­˜æ”¾æ‰€æœ‰çš„ç›‘å¬å‡½æ•°</span><br><span class="line">    let listeners = [];</span><br><span class="line">    let getState = () =&gt; state;</span><br><span class="line">    //æä¾›ä¸€ä¸ªæ–¹æ³•ä¾›å¤–éƒ¨è°ƒç”¨æ´¾å‘action</span><br><span class="line">    let dispath = (action) =&gt; &#123;</span><br><span class="line">        //è°ƒç”¨ç®¡ç†å‘˜reducerå¾—åˆ°æ–°çš„state</span><br><span class="line">        state = reducer(state, action);</span><br><span class="line">        //æ‰§è¡Œæ‰€æœ‰çš„ç›‘å¬å‡½æ•°</span><br><span class="line">        listeners.forEach((l) =&gt; l())</span><br><span class="line">    &#125;</span><br><span class="line">    //è®¢é˜…çŠ¶æ€å˜åŒ–äº‹ä»¶ï¼Œå½“çŠ¶æ€æ”¹å˜å‘ç”Ÿä¹‹åæ‰§è¡Œç›‘å¬å‡½æ•°</span><br><span class="line">    let subscribe = (listener) =&gt; &#123;</span><br><span class="line">        listeners.push(listener);</span><br><span class="line">    &#125;</span><br><span class="line">    dispath();</span><br><span class="line">    return &#123;</span><br><span class="line">        getState,</span><br><span class="line">        dispath,</span><br><span class="line">        subscribe</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let combineReducers=(renducers)=&gt;&#123;</span><br><span class="line">    //ä¼ å…¥ä¸€ä¸ªrenducersç®¡ç†ç»„ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªrenducer</span><br><span class="line">    return function(state=&#123;&#125;,action=&#123;&#125;)&#123;</span><br><span class="line">        let newState=&#123;&#125;;</span><br><span class="line">        for(var attr in renducers)&#123;</span><br><span class="line">            newState[attr]=renducers[attr](state[attr],action)</span><br><span class="line">        &#125;</span><br><span class="line">        return newState;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export &#123;createStore,combineReducers&#125;;</span><br></pre></td></tr></table></div></figure>

<p><img src="/2017/11/18/Redux%E4%B8%89%E5%A4%A7%E5%8E%9F%E5%88%99/001.png"></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2017/06/05/%E6%88%91%E5%AF%B9mvvm%E7%9A%84%E7%90%86%E8%A7%A3/">æˆ‘å¯¹mvvmçš„ç†è§£</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2017-06-05</span></span></div></header><div class="post-body"><div class="post-excerpt"><blockquote>
<p>å¯¹mvvmçš„ç†è§£ï¼š1ã€MVVMæ˜¯ã€Model-View-ViewModelã€‘çš„ç¼©å†™ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäºå‰ç«¯å¼€å‘çš„æ¶æ„æ¨¡å¼ï¼›2ã€æé«˜DOMæ“ä½œä½¿é¡µé¢æ¸²æŸ“æ€§èƒ½ï¼›3ã€ å½“Modelé¢‘ç¹å‘ç”Ÿå˜åŒ–ï¼Œå¼€å‘è€…ä¸éœ€è¦ä¸»åŠ¨æ›´æ–°åˆ°Viewã€‚</p>
</blockquote>
<p>ã€€     MVVM ç”± Modelã€Viewã€ViewModel ä¸‰éƒ¨åˆ†æ„æˆï¼ŒModel å±‚ä»£è¡¨æ•°æ®æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥åœ¨Modelä¸­å®šä¹‰æ•°æ®ä¿®æ”¹å’Œæ“ä½œçš„ä¸šåŠ¡é€»è¾‘ï¼›View ä»£è¡¨UI ç»„ä»¶ï¼Œå®ƒè´Ÿè´£å°†æ•°æ®æ¨¡å‹è½¬åŒ–æˆUI å±•ç°å‡ºæ¥ï¼ŒViewModel æ˜¯ä¸€ä¸ªåŒæ­¥View å’Œ Modelçš„å¯¹è±¡ã€‚</p>
<p>ã€€ã€€åœ¨MVVMæ¶æ„ä¸‹ï¼ŒView å’Œ Model ä¹‹é—´å¹¶æ²¡æœ‰ç›´æ¥çš„è”ç³»ï¼Œè€Œæ˜¯é€šè¿‡ViewModelè¿›è¡Œäº¤äº’ï¼ŒModel å’Œ ViewModel ä¹‹é—´çš„äº¤äº’æ˜¯åŒå‘çš„ï¼Œ å› æ­¤View æ•°æ®çš„å˜åŒ–ä¼šåŒæ­¥åˆ°Modelä¸­ï¼Œè€ŒModel æ•°æ®çš„å˜åŒ–ä¹Ÿä¼šç«‹å³ååº”åˆ°View ä¸Šã€‚</p>
<p>ã€€ã€€ViewModel é€šè¿‡åŒå‘æ•°æ®ç»‘å®šæŠŠ View å±‚å’Œ Model å±‚è¿æ¥äº†èµ·æ¥ï¼Œè€ŒView å’Œ Model ä¹‹é—´çš„åŒæ­¥å·¥ä½œå®Œå…¨æ˜¯è‡ªåŠ¨çš„ï¼Œæ— éœ€äººä¸ºå¹²æ¶‰ï¼Œå› æ­¤å¼€å‘è€…åªéœ€å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ“ä½œDOMï¼Œ ä¸éœ€è¦å…³æ³¨æ•°æ®çŠ¶æ€çš„åŒæ­¥é—®é¢˜ï¼Œå¤æ‚çš„æ•°æ®çŠ¶æ€ç»´æŠ¤å®Œå…¨ç”± MVVM æ¥ç»Ÿä¸€ç®¡ç†ã€‚</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2017/05/02/%E8%AF%B4%E8%AF%B4%E5%AF%B9Redux%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9F%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%9F/">è¯´è¯´å¯¹Reduxä¸­é—´ä»¶çš„ç†è§£ï¼Ÿå¸¸ç”¨çš„ä¸­é—´ä»¶æœ‰å“ªäº›ï¼Ÿå®ç°åŸç†ï¼Ÿ</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2017-05-02</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="ä¸€ã€æ˜¯ä»€ä¹ˆ">
          <a href="#ä¸€ã€æ˜¯ä»€ä¹ˆ" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸€ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€æ˜¯ä»€ä¹ˆ</h2>
      <p>ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰æ˜¯ä»‹äºåº”ç”¨ç³»ç»Ÿå’Œç³»ç»Ÿè½¯ä»¶ä¹‹é—´çš„ä¸€ç±»è½¯ä»¶ï¼Œå®ƒä½¿ç”¨ç³»ç»Ÿè½¯ä»¶æ‰€æä¾›çš„åŸºç¡€æœåŠ¡ï¼ˆåŠŸèƒ½ï¼‰ï¼Œè¡”æ¥ç½‘ç»œä¸Šåº”ç”¨ç³»ç»Ÿçš„å„ä¸ªéƒ¨åˆ†æˆ–ä¸åŒçš„åº”ç”¨ï¼Œèƒ½å¤Ÿè¾¾åˆ°èµ„æºå…±äº«ã€åŠŸèƒ½å…±äº«çš„ç›®çš„</p>
<p><code>Redux</code>æ•´ä¸ªå·¥ä½œæµç¨‹ï¼Œå½“<code>action</code>å‘å‡ºä¹‹åï¼Œ<code>reducer</code>ç«‹å³ç®—å‡º<code>state</code>ï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯ä¸€ä¸ªåŒæ­¥çš„æ“ä½œ</p>
<p>é‚£ä¹ˆå¦‚æœéœ€è¦æ”¯æŒå¼‚æ­¥æ“ä½œï¼Œæˆ–è€…æ”¯æŒé”™è¯¯å¤„ç†ã€æ—¥å¿—ç›‘æ§ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å¯ä»¥ç”¨ä¸Šä¸­é—´ä»¶</p>
<p><code>Redux</code>ä¸­ï¼Œä¸­é—´ä»¶å°±æ˜¯æ”¾åœ¨å°±æ˜¯åœ¨<code>dispatch</code>è¿‡ç¨‹ï¼Œåœ¨åˆ†å‘<code>action</code>è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://static.vue-js.com/57edf750-e699-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<p>å…¶æœ¬è´¨ä¸Šä¸€ä¸ªå‡½æ•°ï¼Œå¯¹<code>store.dispatch</code>æ–¹æ³•è¿›è¡Œäº†æ”¹é€ ï¼Œåœ¨å‘å‡º <code>Action</code>å’Œæ‰§è¡Œ <code>Reducer</code>è¿™ä¸¤æ­¥ä¹‹é—´ï¼Œæ·»åŠ äº†å…¶ä»–åŠŸèƒ½</p>

        <h2 id="äºŒã€å¸¸ç”¨çš„ä¸­é—´ä»¶">
          <a href="#äºŒã€å¸¸ç”¨çš„ä¸­é—´ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#äºŒã€å¸¸ç”¨çš„ä¸­é—´ä»¶" class="headerlink" title="äºŒã€å¸¸ç”¨çš„ä¸­é—´ä»¶"></a>äºŒã€å¸¸ç”¨çš„ä¸­é—´ä»¶</h2>
      <p>æœ‰å¾ˆå¤šä¼˜ç§€çš„<code>redux</code>ä¸­é—´ä»¶ï¼Œå¦‚ï¼š</p>
<ul>
<li>redux-thunkï¼šç”¨äºå¼‚æ­¥æ“ä½œ</li>
<li>redux-loggerï¼šç”¨äºæ—¥å¿—è®°å½•</li>
</ul>
<p>ä¸Šè¿°çš„ä¸­é—´ä»¶éƒ½éœ€è¦é€šè¿‡<code>applyMiddlewares</code>è¿›è¡Œæ³¨å†Œï¼Œä½œç”¨æ˜¯å°†æ‰€æœ‰çš„ä¸­é—´ä»¶ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¾æ¬¡æ‰§è¡Œ</p>
<p>ç„¶åä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥åˆ°<code>createStore</code>ä¸­</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(</span><br><span class="line">  reducer,</span><br><span class="line">  <span class="title function_">applyMiddleware</span>(thunk, logger)</span><br><span class="line">);</span><br></pre></td></tr></table></div></figure>


        <h3 id="redux-thunk">
          <a href="#redux-thunk" class="heading-link"><i class="fas fa-link"></i></a><a href="#redux-thunk" class="headerlink" title="redux-thunk"></a>redux-thunk</h3>
      <p><code>redux-thunk</code>æ˜¯å®˜ç½‘æ¨èçš„å¼‚æ­¥å¤„ç†ä¸­é—´ä»¶</p>
<p>é»˜è®¤æƒ…å†µä¸‹çš„<code>dispatch(action)</code>ï¼Œ<code>action</code>éœ€è¦æ˜¯ä¸€ä¸ª<code>JavaScript</code>çš„å¯¹è±¡</p>
<p><code>redux-thunk</code>ä¸­é—´ä»¶ä¼šåˆ¤æ–­ä½ å½“å‰ä¼ è¿›æ¥çš„æ•°æ®ç±»å‹ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°†ä¼šç»™å‡½æ•°ä¼ å…¥å‚æ•°å€¼ï¼ˆdispatchï¼ŒgetStateï¼‰</p>
<ul>
<li>dispatchå‡½æ•°ç”¨äºæˆ‘ä»¬ä¹‹åå†æ¬¡æ´¾å‘action</li>
<li>getStateå‡½æ•°è€ƒè™‘åˆ°æˆ‘ä»¬ä¹‹åçš„ä¸€äº›æ“ä½œéœ€è¦ä¾èµ–åŸæ¥çš„çŠ¶æ€ï¼Œç”¨äºè®©æˆ‘ä»¬å¯ä»¥è·å–ä¹‹å‰çš„ä¸€äº›çŠ¶æ€</li>
</ul>
<p>æ‰€ä»¥<code>dispatch</code>å¯ä»¥å†™æˆä¸‹è¿°å‡½æ•°çš„å½¢å¼ï¼š</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getHomeMultidataAction</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    axios.<span class="title function_">get</span>(<span class="string">&quot;http://xxx.xx.xx.xx/test&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">      <span class="title function_">dispatch</span>(<span class="title function_">changeBannersAction</span>(data.<span class="property">banner</span>.<span class="property">list</span>));</span><br><span class="line">      <span class="title function_">dispatch</span>(<span class="title function_">changeRecommendsAction</span>(data.<span class="property">recommend</span>.<span class="property">list</span>));</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="redux-logger">
          <a href="#redux-logger" class="heading-link"><i class="fas fa-link"></i></a><a href="#redux-logger" class="headerlink" title="redux-logger"></a>redux-logger</h3>
      <p>å¦‚æœæƒ³è¦å®ç°ä¸€ä¸ªæ—¥å¿—åŠŸèƒ½ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç°æˆçš„<code>redux-logger</code></p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; applyMiddleware, createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> createLogger <span class="keyword">from</span> <span class="string">&#x27;redux-logger&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> logger = <span class="title function_">createLogger</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(</span><br><span class="line">  reducer,</span><br><span class="line">  <span class="title function_">applyMiddleware</span>(logger)</span><br><span class="line">);</span><br></pre></td></tr></table></div></figure>

<p>è¿™æ ·æˆ‘ä»¬å°±èƒ½ç®€å•é€šè¿‡ä¸­é—´ä»¶å‡½æ•°å®ç°æ—¥å¿—è®°å½•çš„ä¿¡æ¯</p>

        <h2 id="ä¸‰ã€å®ç°åŸç†">
          <a href="#ä¸‰ã€å®ç°åŸç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸‰ã€å®ç°åŸç†" class="headerlink" title="ä¸‰ã€å®ç°åŸç†"></a>ä¸‰ã€å®ç°åŸç†</h2>
      <p>é¦–å…ˆçœ‹çœ‹<code>applyMiddlewares</code>çš„æºç </p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">applyMiddleware</span>(<span class="params">...middlewares</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">createStore</span>) =&gt;</span> <span class="function">(<span class="params">reducer, preloadedState, enhancer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> store = <span class="title function_">createStore</span>(reducer, preloadedState, enhancer);</span><br><span class="line">    <span class="keyword">var</span> dispatch = store.<span class="property">dispatch</span>;</span><br><span class="line">    <span class="keyword">var</span> chain = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> middlewareAPI = &#123;</span><br><span class="line">      <span class="attr">getState</span>: store.<span class="property">getState</span>,</span><br><span class="line">      <span class="attr">dispatch</span>: <span class="function">(<span class="params">action</span>) =&gt;</span> <span class="title function_">dispatch</span>(action)</span><br><span class="line">    &#125;;</span><br><span class="line">    chain = middlewares.<span class="title function_">map</span>(<span class="function"><span class="params">middleware</span> =&gt;</span> <span class="title function_">middleware</span>(middlewareAPI));</span><br><span class="line">    dispatch = <span class="title function_">compose</span>(...chain)(store.<span class="property">dispatch</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;...store, dispatch&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>æ‰€æœ‰ä¸­é—´ä»¶è¢«æ”¾è¿›äº†ä¸€ä¸ªæ•°ç»„<code>chain</code>ï¼Œç„¶ååµŒå¥—æ‰§è¡Œï¼Œæœ€åæ‰§è¡Œ<code>store.dispatch</code>ã€‚å¯ä»¥çœ‹åˆ°ï¼Œä¸­é—´ä»¶å†…éƒ¨ï¼ˆ<code>middlewareAPI</code>ï¼‰å¯ä»¥æ‹¿åˆ°<code>getState</code>å’Œ<code>dispatch</code>è¿™ä¸¤ä¸ªæ–¹æ³•</p>
<p>åœ¨ä¸Šé¢çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°äº†<code>redux-thunk</code>çš„åŸºæœ¬ä½¿ç”¨</p>
<p>å†…éƒ¨ä¼šå°†<code>dispatch</code>è¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œç„¶åæ‰§è¡Œå¯¹åº”æ“ä½œï¼ŒåŸç†å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patchThunk</span>(<span class="params">store</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> next = store.<span class="property">dispatch</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dispatchAndThunk</span>(<span class="params">action</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_">action</span>(store.<span class="property">dispatch</span>, store.<span class="property">getState</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">next</span>(action);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    store.<span class="property">dispatch</span> = dispatchAndThunk;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>å®ç°ä¸€ä¸ªæ—¥å¿—è¾“å‡ºçš„åŸç†ä¹Ÿéå¸¸ç®€å•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> next = store.<span class="property">dispatch</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dispatchAndLog</span>(<span class="params">action</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;dispatching:&quot;</span>, <span class="title function_">addAction</span>(<span class="number">10</span>));</span><br><span class="line">  <span class="title function_">next</span>(<span class="title function_">addAction</span>(<span class="number">5</span>));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ–°çš„state:&quot;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">store.<span class="property">dispatch</span> = dispatchAndLog;</span><br></pre></td></tr></table></div></figure>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2017/05/02/Redux%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/">Reduxçš„æ ¸å¿ƒåŸç†</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2017-05-02</span></span></div></header><div class="post-body"><div class="post-excerpt"><p><code>redux</code>è¦æ±‚æˆ‘ä»¬æŠŠæ•°æ®éƒ½æ”¾åœ¨ <code>store</code>å…¬å…±å­˜å‚¨ç©ºé—´</p>
<p>ä¸€ä¸ªç»„ä»¶æ”¹å˜äº† <code>store</code> é‡Œçš„æ•°æ®å†…å®¹ï¼Œå…¶ä»–ç»„ä»¶å°±èƒ½æ„ŸçŸ¥åˆ° <code>store</code>çš„å˜åŒ–ï¼Œå†æ¥å–æ•°æ®ï¼Œä»è€Œé—´æ¥çš„å®ç°äº†è¿™äº›æ•°æ®ä¼ é€’çš„åŠŸèƒ½</p>
<p>å·¥ä½œæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://static.vue-js.com/27b2e930-e56b-11eb-85f6-6fac77c0c9b3.png" alt="img"></p>
<p>æ ¹æ®æµç¨‹å›¾ï¼Œå¯ä»¥æƒ³è±¡ï¼Œ<code>React Components</code> æ˜¯å€Ÿä¹¦çš„ç”¨æˆ·ï¼Œ <code>Action Creactor</code> æ˜¯å€Ÿä¹¦æ—¶è¯´çš„è¯(å€Ÿä»€ä¹ˆä¹¦)ï¼Œ <code>Store</code> æ˜¯å›¾ä¹¦é¦†ç®¡ç†å‘˜ï¼Œ<code>Reducer</code> æ˜¯è®°å½•æœ¬(å€Ÿä»€ä¹ˆä¹¦ï¼Œè¿˜ä»€ä¹ˆä¹¦ï¼Œåœ¨å“ªå„¿ï¼Œéœ€è¦æŸ¥ä¸€ä¸‹)ï¼Œ <code>state</code> æ˜¯ä¹¦ç±ä¿¡æ¯</p>
<p>æ•´ä¸ªæµç¨‹å°±æ˜¯å€Ÿä¹¦çš„ç”¨æˆ·éœ€è¦å…ˆå­˜åœ¨ï¼Œç„¶åéœ€è¦å€Ÿä¹¦ï¼Œéœ€è¦ä¸€å¥è¯æ¥æè¿°å€Ÿä»€ä¹ˆä¹¦ï¼Œå›¾ä¹¦é¦†ç®¡ç†å‘˜å¬åˆ°åéœ€è¦æŸ¥ä¸€ä¸‹è®°å½•æœ¬ï¼Œäº†è§£å›¾ä¹¦çš„ä½ç½®ï¼Œæœ€åå›¾ä¹¦é¦†ç®¡ç†å‘˜ä¼šæŠŠè¿™æœ¬ä¹¦ç»™åˆ°è¿™ä¸ªå€Ÿä¹¦äºº</p>
<p>è½¬æ¢ä¸ºä»£ç æ˜¯ï¼Œ<code>React Components</code> éœ€è¦è·å–ä¸€äº›æ•°æ®, ç„¶åå®ƒå°±å‘ŠçŸ¥ <code>Store</code> éœ€è¦è·å–æ•°æ®ï¼Œè¿™å°±æ˜¯ <code>Action Creactor</code> , <code>Store</code> æ¥æ”¶åˆ°ä¹‹åå» <code>Reducer</code> æŸ¥ä¸€ä¸‹ï¼Œ <code>Reducer</code> ä¼šå‘Šè¯‰ <code>Store</code> åº”è¯¥ç»™è¿™ä¸ªç»„ä»¶ä»€ä¹ˆæ•°æ®</p>
<p>1.å°†åº”ç”¨çš„çŠ¶æ€ç»Ÿä¸€æ”¾åˆ°stateä¸­ï¼Œç”±storeæ¥ç®¡ç†stateã€‚<br>2.reducerçš„ä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„stateå»æ›´æ–°storeä¸­å¯¹ç”¨çš„stateã€‚<br>3.æŒ‰reduxçš„åŸåˆ™,UIå±‚æ¯ä¸€æ¬¡çŠ¶æ€çš„æ”¹å˜éƒ½åº”é€šè¿‡actionå»è§¦å‘ï¼Œactionä¼ å…¥å¯¹åº”çš„reducer ä¸­ï¼Œreducerè¿”å›ä¸€ä¸ªæ–°çš„stateæ›´æ–°storeä¸­å­˜æ”¾çš„stateï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡çŠ¶æ€çš„æ›´æ–°<br>4.subscribeæ˜¯ä¸ºstoreè®¢é˜…ç›‘å¬å‡½æ•°ï¼Œè¿™äº›è®¢é˜…åçš„ç›‘å¬å‡½æ•°æ˜¯åœ¨æ¯ä¸€æ¬¡dipatchå‘èµ·åä¾æ¬¡æ‰§è¡Œ<br>5.å¯ä»¥æ·»åŠ ä¸­é—´ä»¶å¯¹æäº¤çš„dispatchè¿›è¡Œé‡å†™</p>
</div></div></article></section><nav class="paginator"><div class="paginator-inner"><a class="extend prev" rel="prev" href="/page/3/"><i class="fas fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fas fa-angle-right"></i></a></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">43</div><div class="sidebar-ov-state-item__name">å½’æ¡£</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">7</div><div class="sidebar-ov-state-item__name">åˆ†ç±»</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">11</div><div class="sidebar-ov-state-item__name">æ ‡ç­¾</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="çŸ¥è¯†å…±äº«è®¸å¯åè®®" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright Â© 2022</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>ç‰›èµ</span></div><div><span>ç”± <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> å¼ºåŠ›é©±åŠ¨</span><span> v5.4.2</span><span class="footer__devider">|</span><span>ä¸»é¢˜ - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div><div class="busuanzi"><span class="busuanzi-siteuv"><span class="busuanzi-siteuv__icon"><i class="fas fa-user"></i></span><span class="busuanzi-siteuv__info">è®¿é—®äººæ•°</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_uv"></span></span><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">æµè§ˆæ€»é‡</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>